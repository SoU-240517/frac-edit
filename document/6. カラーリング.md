[[機能要求書]]
***

### 6.1. カラーリングアルゴリズムの選択

- **概要:**  
  ユーザーは、フラクタル描画に使用するカラーリングアルゴリズムを選択できます。これにより、フラクタルの視覚的表現を多様化し、作品の雰囲気を自在にコントロールできます。

- **アルゴリズムの種類:**  
  - **発散しない領域:**  
    - **内部距離推定法:** 発散しない点の距離に基づいて色を決定します。  
    - **周期性による色分け:** 点の軌道の周期性を利用して色を割り当てます。  
    - **ポテンシャル関数法:** 発散しない領域のポテンシャル関数を用いて色を決定します。  
  - **発散する領域:**  
    - **反復回数法:** 発散までの反復回数に基づいて色を決定します。  
    - **連続的ポテンシャル法:** 発散領域のポテンシャルを連続的に計算し、滑らかな色変化を実現します。  
    - **軌道トラップ法:** 点の軌道が特定の領域を通過するかどうかに基づいて色を決定します。

- **選択方法:**  
  - パラメータパネル内に「カラーリングアルゴリズム」セクションを設け、ドロップダウンリストからアルゴリズムを選択できます。  
  - 選択したアルゴリズムに応じて、必要なパラメータ（例：トラップの形状や位置）が動的に表示され、ユーザーがスライダーや入力フィールドで調整可能です。

- **リアルタイムプレビュー:**  
  - アルゴリズムの選択やパラメータの調整は、即時にキャンバスの描画に反映されます。これにより、ユーザーは変更の効果をその場で確認できます。

---

### 6.2. グラデーションエディタ

- **概要:**  
  ユーザーは独自のグラデーションを作成・編集し、フラクタル描画に適用できます。グラデーションエディタは**キャンバス描画部分の下部に組み込まれ**、そこで直接編集が可能です。編集結果はリアルタイムでキャンバスの描画に反映されます。

- **機能:**  
  - **グラデーションの表示と編集:**  
    - 選択中のグラデーションがキャンバス描画部分の下部に横長のバーとして表示されます。  
    - グラデーション上の**色点をクリック**するとカラーピッカーが表示され、色を変更できます。  
    - 色点を**ドラッグ**して位置を調整したり、**右クリックメニューやボタン**で色点を追加・削除できます。  
  - **リアルタイム反映:**  
    - グラデーションの編集（色点の移動、色の変更、追加・削除など）は、操作が確定した時点（例：マウスボタンを離したタイミング）で即座にキャンバスの描画に反映されます。  
    - これにより、編集の効果をその場で確認しながら調整が可能です。  
  - **グラデーションの管理:**  
    - グラデーションエディタの領域内に、保存済みのグラデーションを**ドロップダウンリストやサムネイル**で表示し、選択して切り替えられます。  
    - 新しいグラデーションの作成や、既存のグラデーションの保存・読み込みもこの領域から行えます。

- **UI配置:**  
  - **キャンバス描画部分の下部:**  
    - キャンバス描画領域の下に、**横長のグラデーションエディタ領域**を設けます。  
    - この領域には、選択中のグラデーションのプレビュー、色点の編集機能、グラデーションリストの選択UIが含まれます。  
    - ウィンドウの幅に合わせてグラデーションエディタ領域が拡張・縮小し、キャンバスとの一体感を保ちます。  
    - 高さは固定（例：100px）とし、キャンバス描画領域がウィンドウのリサイズ時に優先的に調整されます。  
  - **パラメータパネルとの連携:**  
    - パラメータパネル（メインウィンドウの右側に配置）には、グラデーションの適用方法（例：線形、放射状など）や透明度などの設定を残し、キャンバス下部のグラデーションエディタと連携して動作します。

---
### 6.3. 背景のグラデーション機能

- **概要:**  
  背景に対して、開始点、複数の中間点、終了点を設定し、滑らかなグラデーションを作成できます。これにより、フラクタル描画の背景を美しく装飾し、作品全体の雰囲気を高められます。

- **機能:**  
  - **ポイントの設定:**  
    - 背景に複数の色点を設定し、それぞれの位置（キャンバス上の座標）と色（カラーピッカーで選択）を指定します。  
    - ポイントの追加・削除、位置のドラッグによる調整、色の選択が可能です。  
  - **グラデーションの種類:**  
    - 線形グラデーション、放射状グラデーション、角度付きグラデーションなど、複数のグラデーションタイプをドロップダウンリストから選択できます。  
  - **プレビュー:**  
    - 設定したグラデーションは、キャンバスの背景に即時反映され、リアルタイムで確認できます。

- **UI配置:**  
  - パラメータパネル内に「背景グラデーション」セクションを設け、現在の背景グラデーションのプレビューと「編集」ボタンを配置します。  
  - 「編集」ボタンをクリックすると、背景グラデーション編集ウィンドウがポップアップ表示されます。

---

### 共通仕様

- **リアルタイム反映:**  
  - カラーリングアルゴリズムの選択、グラデーションの編集、背景グラデーションの設定は、すべてリアルタイムでキャンバスの描画に反映されます。これにより、ユーザーは調整の結果を即座に確認しながら作業を進められます。

- **保存と読み込み:**  
  - グラデーションや背景グラデーションの設定は、プロジェクトファイル（例：JSON形式）に保存され、読み込み時に復元されます。これにより、作業の再開や共有が容易になります。

- **エラーハンドリング:**  
  - 無効なパラメータ入力（例：負の反復回数）や、グラデーションの色点が重複する場合などに、適切なエラーメッセージ（例：「色点が重複しています。位置を調整してください。」）を表示し、ユーザーに修正を促します。

- **パフォーマンス:**  
  - カラーリングの計算は、簡易描画モードでは効率的なアルゴリズムを使用し、リアルタイム性を確保します。  
  - 高解像度レンダリング時には、選択されたアルゴリズムに基づき、詳細な計算を行い、品質を最大化します。

---
