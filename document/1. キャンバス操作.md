[[機能要求書]]
***

本仕様は、フラクタルエディタのキャンバス上での操作性を高めるための詳細な仕様です。すべての操作は即時更新を基本とし、ユーザー操作へのレスポンスを最優先に設計されています。また、メインウィンドウは以下のレイアウトとなります。

- **ウィンドウレイアウト**
    
    - 左側：**「キャンバス」タブ**または **「ノード編集」タブ**
        - ※「キャンバス」タブ：フラクタル描画および基本操作（パン、ズーム、簡易描画など）が可能
        - ※「ノード編集」タブ：キャンバス描画は参照専用。ノード編集部分は別途詳細仕様で検討（最低限、最小幅を確保しつつ可変）
    - 右側：**パラメータパネル**（タブ切替用ボタンを内包）

- **ウィンドウサイズ連動時の挙動**
    
    - ウィンドウサイズ変更時は、パラメータパネルの幅は固定し、残りの横幅をキャンバス描画部分（およびノード編集部分）に優先的に割り当てます。
        - **キャンバスタブ時:** キャンバス描画部分がウィンドウ幅に合わせてリサイズされます。
        - **ノード編集タブ時:** キャンバス描画部分が優先され、ノード編集部分は最小幅を確保しつつ可変とします。

---

## 1-1. 左ドラッグによるキャンバス移動

- **概要:**  
    ユーザーがマウスの左ボタンを押下した状態でキャンバス上をドラッグすることで、描画領域（表示範囲）のオフセットを変更し、即時に更新します。
    
- **動作仕様:**
    
    - **ドラッグ開始:**  
        マウス左ボタン押下時にドラッグ開始位置を記録します。
    - **オフセット計算:**  
        マウスの移動量に応じ、現在の表示領域のオフセットを算出します。
    - **即時更新:**  
        補完アニメーションは行わず、ドラッグ中は計算結果に基づきキャンバスを即時再描画します。

- **エラーハンドリング・制約:**
    
    - 極端な高速ドラッグやキャンバス外への移動に対しては、システム内部で安全な移動範囲（スナッピングや最大・最小オフセット）を自動的に設定し、安定動作を保証します。

---
## 1-2. ホイールによるズーム操作

- **概要:**  
    マウスホイールの回転により、キャンバス上のフラクタル描画のズームレベルを変更します。ズームの中心は、操作時のマウスカーソル位置となります。
    
- **動作仕様:**
    
    - **ズームイン/アウト:**
        - ホイールを上に回すとズームイン、下に回すとズームアウトします。
        - 操作時、マウスカーソル位置を基準としてズームを適用し、ユーザーが注目する部分の拡大・縮小を可能にします。
    - **倍率制御:**
        - システム内で設定された最小倍率および最大倍率の範囲内でズーム操作を実行します。
        - ズーム倍率の変化ステップは内部で決定し、将来的にはユーザー設定による変更も可能とします。
    - **ズーム感度:**
        - ズーム操作の感度はユーザーが調整可能とし、感度設定用のスライダーや数値入力フィールドをパラメータパネルに実装します。

- **エラーハンドリング・制約:**
    
    - ズーム操作が設定範囲（最小・最大倍率）を超えないよう、自動補正を行います。
    - ズーム操作中は、プログレスインジケーター等で進行状況のフィードバックをユーザーに提供します。

---
## 1-3. 簡易描画モード

- **概要:**  
    操作中は、最終レンダリングを除く全ての描画処理を「簡易描画モード」で実施し、計算負荷を軽減しつつ操作レスポンスを向上させます。
    
- **動作仕様:**
    
    - **計算点の間引き:**
        - 操作中は描画に必要な計算点を間引くことで、リアルタイム描画の負荷を削減します。
        - この間引き率は、操作速度やシステム負荷に応じて動的に調整される仕組みとします。
    - **切替タイミング:**
        - ユーザーがフラクタルパラメータを変更するたびに、即時に簡易描画モードで再描画を行い、迅速なフィードバックを提供します。
    - **最終レンダリングとの区別:**
        - パラメータパネル内の「作品描画」ボタンが押された場合にのみ、超高解像度での最終レンダリングを実施します。

- **代替技術の検討:**
    
    - 点の間引き以外に、局所的なLOD（Level of Detail）技術やGPUシェーダを利用したリアルタイム補完手法の導入も検討し、将来的な拡張性を確保します。

---
## 1-4. 簡易描画精度の調整

- **概要:**  
    ユーザーが簡易描画の品質（計算点の間引き率）を自由に調整できるよう、パラメータパネルに設定項目を設けます。
    
- **動作仕様:**
    
    - **設定インターフェース:**
        - 数値入力フィールドおよびスライダーを用いて、簡易描画時の計算点密度または間引き率を設定可能とします。
        - ユーザーはスライダー操作または直接数値入力により、好みの設定が行えます。
    - **即時反映:**
        - 設定変更は即時に簡易描画に反映され、キャンバス上の描画品質が動的に更新されます。

---
## 共通仕様

- **キャンバスリサイズ:**
    - キャンバスはウィンドウサイズに連動して自動的にリサイズされます。
    - **キャンバスタブ時:**
        - パラメータパネルの幅は変更せず、キャンバス描画部分がウィンドウの横幅に合わせて拡大・縮小します。
    - **ノード編集タブ時:**
        - パラメータパネルの幅は固定。
        - キャンバス描画部分はウィンドウの横幅に合わせて拡大・縮小し、ノード編集部分は最小幅を確保しつつ可変とします。
    - ウィンドウリサイズに伴い、現在のズームやパンの状態は維持されるよう設計します。

- **操作の即時反映:**
    - すべての操作（パン、ズーム、簡易描画の調整）は、ユーザー入力に対して即時反映される設計とします。

- **進行状況フィードバック:**
    - 特に最終レンダリング時には、プログレスバーやインジケーターで処理進行状況をユーザーに明示します。

- **エラーハンドリング:**
    - 急速なパンや過度なズーム操作など、極端な入力に対してはシステム内部で安全な動作範囲を設定し、不正な動作や視認性低下を防止します。
    - 必要に応じ、ユーザーに対して適切なエラーメッセージや警告を表示します。

---
